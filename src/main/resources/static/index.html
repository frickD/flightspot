<!DOCTYPE html>
<html lang="en">
<head>
  <title>Flight Spot</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">
  <link rel="stylesheet" href="css/style.css">
  <link rel="stylesheet" href="css/all.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.7.2/animate.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>
  <script src="lib/anime/anime.min.js"></script>
</head>
<body>

  <div id="loader" style="    background: #499ca3;background: linear-gradient(51deg, #499ca3 0%, #3ebf95 100%);position: absolute; top: 0; left: 0; height: 100%; width: 100%;">
    <img class="animated zoomIn" src="img/white_logo.png" style=" position: absolute; margin: auto;top: 0;left: 0;right: 0;bottom: 0;max-width:40%; animation-iteration-count: infinite;">
  </div>


  <div id="app" style="display:none">
  <nav class="navbar navbar-light fixed-top cobee-header">

        <a class="navbar-brand" style="margin-right: 0;" href="index.html">
        <img style="max-width:100px" src="img/white_logo.png">
      </a>
        <!--<div id="login-button" onclick="displayTab('profile')" class="navbar-login-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" style="fill:white"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/><path d="M0 0h24v24H0z" fill="none"/></svg></div>-->
    </nav>

<div id="app-content" style="margin-top:80px">
  <div id="camera-content" style="">
    <div class="container" style="margin-top: 90px;">

      <div class="card">
          <div class="card-header color-background" id="headingTwo">
            <h5 class="mb-0">
              <button style="color:white" class="btn btn-link collapsed" data-toggle="collapse" data-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                Neuen Flieger hinzufügen
              </button>
            </h5>
          </div>
          <div id="collapseTwo" class="collapse" aria-labelledby="headingTwo" data-parent="#accordion">
            <div class="card-body">
              <h5 style="margin-top:30px"class="card-title">Scanne deine Medikamente.</h5>
              <p class="card-text">Scanne mit einen Flieger deine Medikamente, um mehr Informationen wie beispielsweise Gebrauchsanweisung zubekommen. Dank AI kann CoBee dir verraten, was du gerade vor dir hast.</p>

              <form onclick="openGallery()" enctype="multipart/form-data" class="text-center">
                <label class="custom-file-upload">
                  <input id="file_input" name="files" type="file"/>
                  <i style="font-size:70px;" class="fas fa-camera"></i>
                </label>
              </form>

              <a id="send_btn" onclick="sendIBMVR()" class="btn btn-cobee" style="display: none;width:100%;color:white">Analyse starten</a>
            </div>

            </div>
          </div>

          <div class="card" style="margin-top:20px">
            <div class="card-header color-background">
              Neuen Flieger hinzufügen
            </div>
            <div class="card-body">
              <div class="text-center">
                <img  style="width:100px"src="img/cobee/camera.png"></img>
              </div>
              </div>
          </div>

    </div>
  </div>


  <div class="jumbotron text-center" style="margin-top: 50px;margin-bottom:0;background:#dcdcdc!important"></div>
</div>




<div id="medicament-modal" class="modal" tabindex="-1" role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">AI Medikamenten Suche</h5>
      </div>
      <div class="modal-body">
        <div class="card">
          <div class="card-header color-background">
            Folgendes Medikament gefunden:
          </div>
          <div class="card-body">
            <div class="text-center">
              <img  id="medicament-img" style="width:100px"src="img/cobee/info.png"></img>
            </div>
            <h5 id="medicament-title"  style="margin-top:30px"class="card-title">Willkommen bei CoBee.</h5>
            <p id="medicament-description"  class="card-text"></p>
          </div>
        </div>

        <div id="accordion" style="margin-top:30px">

          <div class="card">
            <div class="card-header color-background" id="headingTwo">
              <h5 class="mb-0">
                <button  style="color:white" class="btn btn-link collapsed" data-toggle="collapse" data-target="#collapseOne" aria-expanded="false" aria-controls="collapseOne">
                  Verwendung.
                </button>
              </h5>
            </div>
            <div id="collapseOne" class="collapse" aria-labelledby="headingTwo" data-parent="#accordion">
              <div  id="medicament-usage" class="card-body">

              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-header color-background" id="headingTwo">
              <h5 class="mb-0">
                <button style="color:white" class="btn btn-link collapsed" data-toggle="collapse" data-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                  Effekt.
                </button>
              </h5>
            </div>
            <div id="collapseTwo" class="collapse" aria-labelledby="headingTwo" data-parent="#accordion">
              <div id="medicament-effect" class="card-body">

              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-header color-background" id="headingThree">
              <h5 class="mb-0">
                <button style="color:white" class="btn btn-link collapsed" data-toggle="collapse" data-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
                  Inhaltsstoffe.
                </button>
              </h5>
            </div>
            <div id="collapseThree" class="collapse" aria-labelledby="headingThree" data-parent="#accordion">
              <div id="medicament-substances"  class="card-body">

              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Okay</button>
      </div>
    </div>
  </div>
</div>


</div>

</body>
</html>

<script>
window.onload = function() {
      initApp();
};

function initApp() {
  runLoader(false);
}

  function requestAPI(form) {
    runLoader(true);
    var settings = {
      "async": true,
      "crossDomain": true,
      "url": "https://gateway.watsonplatform.net/visual-recognition/api/v3/classify?version=2018-03-19",
      "method": "POST",
      "headers": {
        "authorization": "Basic YXBpa2V5OktndVlSYll0Y3ZvdUVaSEwwdVNDMzl1Rl9aS2lBS2pPd0tVV21rNUNYZ08z"
      },
      "processData": false,
      "contentType": false,
      "mimeType": "multipart/form-data",
      "data": form
    }
    $.ajax(settings).done(function(response) {
      runLoader(false);
      var res = JSON.parse(response);
      console.log(res);
      if (typeof res.images[0].classifiers[0].classes[0].class != "undefined") {
        var product = res.images[0].classifiers[0].classes[0].class;
        if(product=="Dobendan_Pill"){
          $("#medicament-img").attr("src",products[12].img);
          $("#medicament-title").text(products[12].name);
          $("#medicament-description").text(products[12].fieldofuse);
          $("#medicament-usage").text(products[12].dosage);
          $("#medicament-substances").text(products[12].activesubstances);
          $("#medicament-effect").text(products[12].contraindications);
          $("#medicament-modal").modal("show");
        }
      }
    }).fail(function(e) {
      runLoader(false);
    });
  }

    function openGallery(){
      $("#send_btn").fadeIn(1000);
    };

    function sendIBMVR(){
      //$("#app").hide();
      //$("#preloader").fadeIn();
      var form = new FormData();
      form.append('images_file', $('input[type=file]')[0].files[0]);
      form.append("classifier_ids", "DefaultCustomModel_933387654");
      requestAPI(form);
    };

    function runLoader(shouldRun){
     if(shouldRun){
       $("#app").hide();
       $("#loader").fadeIn();
     }else{
       $("#app").fadeIn();
       $("#loader").hide();
     }
    }


</script>
